# Проверка плана улучшений на соответствие ТЗ

## Ключевые пункты ТЗ (кратко)
- Автоматизация браузера с видимым (не headless) режимом и persistent-сессиями.
- Автономный AI-агент на OpenAI/Claude, сам принимает решения для многошаговых задач.
- Экономное управление контекстом: нельзя слать целые страницы в промпт.
- Продвинутый паттерн: sub-agents, адаптивная обработка ошибок или security-layer с подтверждением.
- Запрещено: заранее заготовленные сценарии и селекторы; хардкод ссылок/кнопок; подсказки про структуру конкретных сайтов.

## Соответствие предложенного плана
- **Расширение dom_snapshot и эвристик поиска** — соответствует: собираем больше метаданных (aria/placeholder/role), но без преднаписанных селекторов; поиск строится на общих признаках, не на хардкоде конкретных страниц.
- **Vision-fallback при отсутствии элемента** — соответствует: используется как универсальный механизм, а не готовый сценарий; координаты и подсказки извлекаются динамически.
- **Доступ к скриншотам для агента** — соответствует: даём агенту вспомогательный контекст без передачи целых страниц; сохраняем пути и описания, не фиксируем структуру сайтов.
- **Надёжный выбор продукта в Лавке** — соответствует при условии: фильтрация карточек идёт по текстовым совпадениям текущего запроса ("хот-дог", "бургер" и т.п.) и состоянию кнопок, без жёстких селекторов или URL; ранжирование и проверки URL/DOM выполняются универсально.
- **Fallback при отключённом scroll** — соответствует: реагируем на сообщения инструмента и пробуем альтернативные действия; нет заранее прописанных шагов.
- **Fix subagent.matches** — соответствует: добавляется метод и юнит-тест, сохраняя sub-agent архитектуру; без хардкода доменных путей.
- **Планировщик для поиска/корзины** — соответствует, если чек-лист остаётся общим (поиск → выбор товара → корзина → checkout) без привязки к конкретным сайтам.
- **Расширенные логи** — соответствует: собираем диагностические данные; не нарушает ограничений и помогает проверять безопасность.

## Риски нарушения и как их избежать
- **Преднаписанные селекторы или URL**: не добавлять прямые селекторы/пути для YouTube или Лавки; все клики — через динамически найденные элементы (role/text/aria, vision-подсказки, Tab-навигация).
- **Заготовленные сценарии**: планировщик должен формировать шаги от задачи, а не хранить фиксированные цепочки; чек-листы формулировать как общие правила.
- **Передача страниц в контекст**: следить, чтобы vision/DOM-снапшоты пересылались компактно; хранить ссылки на скриншоты вместо полного содержимого.
- **Security-layer**: оставить запрос подтверждения для потенциально рискованных действий (оплата, оформление заказа) — план не отменяет этот слой.

## Итог
План улучшений укладывается в требования ТЗ, если соблюдать описанные оговорки: только универсальные эвристики, никаких жёстко прописанных селекторов или URL, отсутствие фиксированных сценариев, сохранение security-layer и экономного контекста.
